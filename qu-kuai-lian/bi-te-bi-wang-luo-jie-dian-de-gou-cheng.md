## 比特币网络节点的构成

比特币网络是一种**点对点的数字现金系统（P2P）**，网络节点中每台机器都彼此对等。P2P网络不存在任何服务端、层级关系或者中心化服务。

### 节点类型与分工

### ![](/assets/比特币网络节点分工.png)

一个全功能节点包含上述4个模块【钱包**W**allet】【矿工**M**iner】【完整区块链full **B**lock-chain database】【网络路由节点**N**etwork routing】

* 【网络路由节点】使得节点具有**参与验证并传播交易与区块信息，发现监听并维持点对点的链接**的能力

* 【完整区块链】具有此模块的节点被称为：全节点。它能够**独自自主的校验所有交易**，不需要任何其他信息。

* 【钱包】比特币的所有权是通过数字密钥、比特币地址和数字签名来确定的，数字密钥实际上并不是存储在网络中，而是由用户生成并存储在一个文件或简单的数据库中，称为钱包。有些节点仅仅保留**区块链的一部分**，通过一种”简易支付验证“（SPV Simplified Payment Verification）的方法来完成交易。

* 【矿工】挖矿节点以相互竞争的方式创造新的区块。有一些挖矿节点也是全节点，可以独立挖矿；还有一些参与矿池挖矿的节点是轻量级节点，**必须依赖矿池服务器维护全节点进行工作。**

拥有全部四个模块被称之为**核心客户端（Bitcoin Core）**，除了这些主要节点类型外，还有一些服务器及节点运行其他协议，如特殊矿池挖矿协议、轻量级客户端访问协议。

下表为扩展比特币网络的不同节点类型  
![](/assets/比特币网络的不同节点.png)

### 扩展比特币网络

要在全世界的网络中完成整个的交易，下图描述了一个扩展比特币网络，它包含了多重类型的节点、网关服务器、边缘路由器、钱包客户端以及它们互相连接所需要的各类协议，比特币互相连接的接口一般使用`8333端口`

### ![](/assets/扩展比特币网络.png)

### 如何控制区块产生速度恒定

#### 难度系数

**工作量证明：**是寻找一个特殊数字使得SHA256函数的输出字符串的前`n`位是零

对于每一种不同的加密货币来说，都有**一个值**需要在建立货币的时候时候被定义，即**每一个新区块在当前全网算力的条件被发现的【平均时间】**，这也是难度系数的由来。

> 比特币10分钟；以太坊15秒；瑞波币3.5秒；莱特币2.5分钟

抛开代码算法层面来说，实现方法就是通过找前`n`位是0的方法。从概率角度来说，n值越大，意味找到这个这个数的解范围越小。

随着需求`0`的数目一个一个增加，**需要的计算时间将会程指数增长**。

#### 难度调整方式

难度的调整实在每个完整节点中自动发生的。如果网络发现区块产生速率比10分钟要快时会增加难度。如果发现比10分钟慢时则降低难度。

例如比特币中的是这样定义的：每2016个区块后计算生成它们花费的时长，比上20160（14天）调整一次。有人可能会问，如果在这十四天内计算能力暴涨怎么办，其实这个10分钟的区块新建间隔的规定也只是一个估计要求，真实情况下，**这个时间会偏离10分钟这个设定值很多，但是这种偏差并不会对整个区块链的运行产生影响**

但是有人会问，这个过程是靠脚本（代码）来实现的，还是自己手动调整的呢？答案是，本地挖矿节点根据自己看到的链上信息自己调整。

问题又来了，为何我不自己降低难度，让自己更加容易新建区块呢？其实，因为链上所有节点确认新的区块（只有确认了你才能得到回报）是按照最长链并且计算难度最大来判断的，你如果用很小的难度新加的区块，是肯定跑不赢全网的其他矿工的

  
  
  


### 参考

* [https://charlesliuyx.github.io/2017/09/24/一文弄懂区块链-以比特币为例/](https://charlesliuyx.github.io/2017/09/24/一文弄懂区块链-以比特币为例/)



